# name: ci
# on: [push]
# jobs:
#   build-and-test:
#     runs-on: ubuntu-20.04
#     steps:
#       - name: Checkout ðŸ›Ž
#         uses: actions/checkout@v2

#       - name: Install dependencies
#         run: npm ci

#       - name: Lint
#         run: npm run lint  
      
#       - name: Start the app
#         run: BETA=true npm run start:proxy &

#       - name: Wait for URL
#         run: npx wait-on https://stage.foo.redhat.com:1337/beta/edge

#       - name: Run Cypress tests ðŸ§ª
#         run: npx cypress run --e2e --record
#         env:
#           CYPRESS_RECORD_KEY: ${{secrets.CYPRESS_RECORD_KEY}}

name: Using Cypress GH Action
on: push
jobs:
  single-run:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v1
      - name: Use Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '14'
      - name: add /etc/hosts
        run: echo 127.0.0.1 stage.foo.redhat.com | sudo tee -a /etc/hosts 
      - name: Cypress run
        uses: cypress-io/github-action@v4
        timeout-minutes: 10
        with:
          record: true
          start: "npm run start:proxy"
          wait-on: 'https://stage.foo.redhat.com:1337/edge'
        env:
          CYPRESS_RECORD_KEY: ${{secrets.CYPRESS_RECORD_KEY}}
          NODE_TLS_REJECT_UNAUTHORIZED: 0